---
title: 'How to import Swift macros into your project as binaries'
excerpt: '.'
pubDate: 2023-11-28
---

## Creating a Swift macro

There are two easy ways to create a Swift macro: using Xcode's template or using the `swift package` command line tool.

The outcome of both methods is identical and, making use of a template, will create a Swift package with a ready-to-use example freestanding macro called `#stringify`.

By default, the structure for a Swift macro usually consists of three targets:

1. The `library` target: This target will usually be named after the macro itself (in this case `Stringify`) and its purpose will be to expose the macro as part of its public API to its consumers.
2. The `macro` target: This target's name will usually be the macro name followed by the word `Macros` (in this case `StringifyMacros`) and the target will contain the list and implementation of all macros defined in the package.
3. **Optional** The `executable` target: This target's name will usually be the macro name followed by the word `Client` (in this case `StringifyClient`) and will allow you to test the macro in the same way its consumers will. This target is optional really, you can get rid of it and achieve the same coverage through unit tests.

Alongside these targets, you will usually have two products defined in the package's manifest:

1. A `library` product: This product is associated with the `library` target and it is the one the consumers of this package will use to import the macro into their projects when using Swift Package Manager.
2. **Optional** An `executable` product: This product is associated with the `executable` target above and its only use is to provide a way to test and run the macro in a standalone environment.

### Using Xcode

If you'd like to create a Swift macro using Xcode, you first need to create a new Swift package by clicking on `File > New > Swift Package...` and then selecting the `Macro` template:

![]()

Next, give the package a name and select a location for it:

![]()

### Using `swift package init`

You can achieve the same result as above directly from the terminal.

To do so, create a new directory for your macro and navigate to it:

```bash:Terminal
mkdir stringify-macro
cd stringify-macro
```

Next, use the `swift` command line tool to create a new Swift package using the `package init` command and the `--type` flag set to `macro`:

```bash:Terminal
swift package init --name Stringify --type macro
```

## Compiling a macro into a binary

As I mentioned at the beginning of this article, there might be situations where you might not want or be able to import the macro into your project as a Swift package dependency.

In that case, you can compile the macro into a binary and import it directly. The first step to do so is to build the macro into a binary by navigating into the package directory and using the `swift build` command:

```bash:Terminal
cd stringify-macro

swift build -c release
```

At this point you might be wondering, how can we compile the macro into a binary if we haven't defined it as a product? If you remember correctly, we only had two products defined in the package's manifest: a `library` that exposes the macro for clients to use and an `executable` target for testing purposes.

Due to the way Swift Package Manager works with `.macro` targets and the fact that it's imported by the library product, the macro target will be compiled into a binary by default.

To find the binary, navigate to the `.build > release` directory and you should find a file called `StringifyMacros` which you will use in the next step to import the macro into your project.

## Importing the macro binary into your target

Now that you have the macro binary ready, you can import it into your project in just a couple of steps.

First, drag and drop the binary you created in the last section into the directory where your project's `.xcodeproj` file is located. I would recommend moving it into the root directory of the project (next to the `.xcodeproj` file) and creating a new directory called `Macros` to keep things tidy.

Next, go to the target where you want to use the macro's `Build Settings` in Xcode and look for the `Other Swift Flags` settings under the `Swift Compiler - Custom Flags` section. You will need to add the `-load-plugin-executable-macros` to this setting followed by a string composed of the path to the binary you just created and the name of the `.macro` target in your swift package joined by a hash symbol (e.g. `macros/StringifyMacros#StringifyMacros`):

![]()

## Using the macro in a CocoaPods library

```

```

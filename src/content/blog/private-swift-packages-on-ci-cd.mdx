---
title: 'Private Swift packages on CI/CD'
excerpt: 'How to build an app that depends on private Swift packages on CI/CD.'
pubDate: 2023-05-24
---

At work we have recently started to use Swift packages to share code between our iOS apps across different products and teams.
Due to the nature of the code we are sharing, we needed the host the packages on internal GitHub repositories accessible only to our organisation.

This caused a myriad of issues when trying to build our app on CI/CD using these new packages as we had previously only dependend on public packages in the past.

In this article I will go through the solution we came up with and how we leveraged the use of GitHub personal access tokens to make it work on CI/CD.

## The requirements

We use GitHub actions as our CI/CD tool of choice and, by default, it clones the current repository using a short-lived token with a very narrow scope through the `@actions/checkout` action.

For this reason, our runners are not set up to use SSH keys and by default only have access to the repository that triggered the workflow. Access to any other repositories must be granted explicitly through the use of an elevated access token.

We wanted to preserve this behaviour only grant access during the execution of a workflow, so we decided to use a personal access token with access to clone all repositories in our organisation.

## Building the app locally

All developers in our team use SSH keys to authenticate with GitHub and have access to all repositories in our organisation.

For this reason, we decided to define our private Swift package dependencies using SSH URLs in the `Package.swift` manifest:

```swift:Package.swift
// swift-tools-version:5.7

import PackageDescription

let package = Package(
    name: "YourAwesomePackage",
    products: [
        .library(
            name: "YourAwesomePackage",
            targets: ["YourAwesomePackage"]
        )
    ],
    dependencies: [
        .package(url: "git@github.com:your-org/your-dependency.git", exact: "1.0.0")
    ],
    targets: [
        .target(
            name: "YourAwesomePackage",
            dependencies: [.product(name: "YourDependency", package: "your-dependency")]
        )
    ]
)
```

## Building the app on CI/CD

### Using an 'elevated' access token

### Modifying the global git config

### Storing the access token in the cache

### Removing the access token from the cache
